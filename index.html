<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Recicla Tech ‚Äî Prot√≥tipo</title>
  <style>
    :root{--accent:#2a9d8f;--muted:#6b7280;--bg:#f7fafc}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, Roboto, "Helvetica Neue", Arial; margin:0; background:var(--bg); color:#0f172a}
    header{background:linear-gradient(90deg,#0ea5a3, #2a9d8f); color:white; padding:28px 18px}
    .container{max-width:960px;margin:24px auto;padding:0 18px}
    h1{margin:0;font-size:1.6rem}
    p.lead{margin:8px 0 0;opacity:.95}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:18px;margin-top:18px}
    .card{background:white;border-radius:12px;padding:16px;box-shadow:0 6px 18px rgba(15,23,42,0.06)}
    .full{grid-column:1/-1}
    ul{padding-left:1.1rem}
    .btn{display:inline-block;padding:8px 12px;border-radius:8px;border:none;background:var(--accent);color:white;text-decoration:none;cursor:pointer}
    footer{text-align:center;color:var(--muted);font-size:.85rem;margin:32px 0}

    /* quiz */
    .question{margin-bottom:12px}
    .options button{display:block;width:100%;text-align:left;margin:6px 0;padding:10px;border-radius:8px;border:1px solid #e6edf0;background:#fff}

    /* responsive */
    @media (max-width:820px){.grid{grid-template-columns:1fr}}
  </style>
</head>
<body>

<header id="interactiveHeader">
  <div class="header-container">
    <h1 class="animated-title">
      Recicla Tech <span>üå±</span><br>
      Conectando Tecnologia e Sustentabilidade
    </h1>
    <p class="header-lead">
      Prot√≥tipo funcional criado para a ONG Recicla Capixaba ‚Äî guia de reciclagem, pontos de coleta e mini-quiz educativo.
    </p>
  </div>
</header>

<style>
/* Header base */
#interactiveHeader {
  position: relative;
  height: 350px;
  overflow: hidden;
  background: linear-gradient(135deg, #06b6d4, #2a9d8f, #16a34a);
  display: flex;
  align-items: center;
  justify-content: center;
  color: white;
}

#headerCanvas, #bodyCanvas {
  position: absolute;
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: 0;
}
#interactiveHeader { position: relative; overflow: hidden; }
body { position: relative; overflow-x: hidden; }


/* container com leve fundo para destacar o t√≠tulo */
.header-container {
  position: relative;
  text-align: center;
  z-index: 1;
  max-width: 960px;
  padding: 18px 18px;
  background: rgba(0,0,0,0.15); /* fundo semitransparente */
  border-radius: 12px;
}

/* t√≠tulo com efeito neon e gradiente animado */
.animated-title {
  font-size: 2.6rem;
  font-weight: 900;
  line-height: 1.3;
  background: linear-gradient(90deg, #06b6d4, #2a9d8f, #16a34a, #2a9d8f, #06b6d4);
  background-size: 400% 400%;
  -webkit-background-clip: text;
  -webkit-text-fill-color: transparent;
  background-clip: text; /* para Firefox moderno */
  color: transparent;      /* fallback */
  animation: gradientShift 8s ease infinite;
  margin: 0;
  text-shadow:
    0 0 2px #06b6d4,
    0 0 4px #2a9d8f,
    0 0 8px #16a34a;
}


.animated-title span {
  display: inline-block;
  animation: bounce 2s infinite;
}

.header-lead {
  font-size: 1.1rem;
  margin-top: 14px;
  opacity: 0.95;
  text-shadow: 1px 1px 6px rgba(0,0,0,0.25);
}

/* Gradiente animado */
@keyframes gradientShift {
  0% { background-position: 0% 50%; }
  50% { background-position: 100% 50%; }
  100% { background-position: 0% 50%; }
}

/* Emoji animado */
@keyframes bounce {
  0%, 100% { transform: translateY(0); }
  50% { transform: translateY(-12px); }
}

/* Responsividade */
@media (max-width:820px) {
  .animated-title { font-size: 2rem; }
  .header-lead { font-size: 1rem; }
}
body {
  font-family: Inter, system-ui, -apple-system, Roboto, "Helvetica Neue", Arial;
  margin: 0;
  color: #0f172a;
  background: linear-gradient(to bottom, #d0f0c0, #a8e6cf); /* tons suaves de verde */
  position: relative;
  overflow-x: hidden;
}

#bodyCanvas {
  position: absolute; /* ou fixed se quiser efeito full-screen */
  top: 0;
  left: 0;
  width: 100%;
  height: 100%;
  pointer-events: none;
  z-index: -1; /* garante que n√£o bloqueie nenhum bot√£o */
}


</style>


<canvas id="headerCanvas"></canvas>
<canvas id="bodyCanvas"></canvas>
  <main class="container">
    <section class="grid">
      <article class="card">
        <h2>Guia r√°pido: tipos de materiais</h2>
        <p class="muted">Resumo simples para identificar e separar corretamente.</p>
        <ul>
          <li><strong>Papel:</strong> jornais, revistas, caixas limpas ‚Äî sem pl√°stico colado.</li>
          <li><strong>Papel√£o:</strong> embalagens fortes, caixas (amassar antes de descartar).</li>
          <li><strong>Pl√°stico:</strong> garrafas PET, embalagens (esvaziar e enxaguar).</li>
          <li><strong>Vidro:</strong> garrafas e frascos ‚Äî remover tampas pl√°sticas.</li>
          <li><strong>Metais:</strong> latas e tampas ‚Äî enxaguar restos.</li>
          <li><strong>Org√¢nicos:</strong> restos alimentares ‚Äî seguir log√≠stica local (compostagem).</li>
        </ul>
        <p style="margin-top:8px;font-size:.95rem;color:var(--muted)">Dica: mantenha os materiais limpos e secos ‚Äî isso aumenta a reciclagem.</p>
      </article>

      <article class="card">
        <h2>Dicas r√°pidas de reaproveitamento</h2>
        <ul>
          <li>Transforme potes de vidro em organizadores.</li>
          <li>Caixas de papel√£o podem virar hortas verticais.</li>
          <li>Embalagens limpas de pl√°stico servem para armazenamento.</li>
        </ul>
      </article>

      <section class="card full" id="pontos">
        <h2>Pontos de coleta parceiros</h2>
        <p style="color:var(--muted)">Lista de pontos ‚Äî exemplos fict√≠cios que podem ser trocados pela equipe da ONG.</p>
        <div>
          <ol id="collectionList">
            <!-- preenchido por JS -->
          </ol>
          <p style="margin-top:8px;color:var(--muted)">Clique em "Abrir no mapa" para ver a localiza√ß√£o no Google Maps.</p>
        </div>
      </section>

      <article class="card">
        <h2>Mini-quiz educativo</h2>
        <div id="quiz"></div>
        <div id="quizResult" style="margin-top:10px"></div>
      </article>

      <article class="card">
        <h2>Feedback / Reportar recolha</h2>
        <form id="contactForm">
          <label>Seu nome (opcional)<br><input type="text" name="name" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #e6edf0"></label>
          <label style="display:block;margin-top:8px">Mensagem<br><textarea name="message" rows="4" style="width:100%;padding:8px;margin-top:6px;border-radius:6px;border:1px solid #e6edf0"></textarea></label>
          <div style="margin-top:8px"><button class="btn" type="submit">Enviar (simulado)</button></div>
          <p id="contactFlash" style="margin-top:8px;color:var(--muted)"></p>
        </form>
      </article>

    <footer>
      Prot√≥tipo criado para o projeto <em>Recicla Tech</em> ‚Äî use, adapte e compartilhe com a ONG.
    </footer>
  </main>

<!-- Importa o Leaflet e Chart.js -->
<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<script>
/* ========== CONFIG / PONTOS ========== */
const collectionPoints = [
  { name: "Ponto de Coleta - Pra√ßa Central", address: "Pra√ßa Central, Bairro Centro, Vit√≥ria - ES", lat: -20.3175, lng: -40.3370 },
  { name: "Escola Municipal Jo√£o Silva", address: "R. das Flores, 123, Bairro Boa Vista", lat: -20.3188, lng: -40.3305 },
  { name: "Supermercado Verde", address: "Av. Principal, 456", lat: -20.3202, lng: -40.3351 },
];

const list = document.getElementById("collectionList");
collectionPoints.forEach((p, idx) => {
  const li = document.createElement("li");
  li.style.marginBottom = "10px";
  li.innerHTML = `
    <strong>${p.name}</strong><br>
    <span style="color:var(--muted)">${p.address}</span><br>
    <button class="btn" onclick="openMap(${idx})">Ver no mapa</button>
    <button class="btn" style="background:#1e293b;margin-left:8px" onclick="copyAddress(${idx})">Copiar endere√ßo</button>`;
  list.appendChild(li);
});

function copyAddress(i) {
  const text = `${collectionPoints[i].name} - ${collectionPoints[i].address}`;
  navigator.clipboard?.writeText(text).then(()=> alert("Endere√ßo copiado.")).catch(()=> alert("N√£o foi poss√≠vel copiar."));
}

/* ========== MODAL MAPA (LEAFLET) ========== */
const modal = document.createElement("div");
modal.id = "mapModal";
modal.innerHTML = `
  <div id="modalContent">
    <span id="closeModal">&times;</span>
    <h3 id="modalTitle"></h3>
    <div id="map" style="height:350px;border-radius:12px"></div>
    <p id="distanceInfo" style="color:var(--muted);margin-top:10px"></p>
    <div style="text-align:right;margin-top:10px">
      <button id="routeBtn" class="btn">Tra√ßar rota</button>
    </div>
  </div>`;
document.body.appendChild(modal);

const style = document.createElement("style");
style.innerHTML = `
  #mapModal { display:none; position:fixed; z-index:1000; left:0; top:0; width:100%; height:100%; background-color:rgba(0,0,0,0.6); }
  #modalContent { background:#fff; margin:6% auto; padding:20px; border-radius:12px; width:90%; max-width:650px; box-shadow:0 6px 20px rgba(0,0,0,0.25); position:relative; }
  #closeModal { position:absolute; top:8px; right:14px; font-size:24px; cursor:pointer; }
  #closeModal:hover { color:red; }
  /* hist√≥rico modal */
  #historyModal { display:none; position:fixed; z-index:1100; left:0; top:0; width:100%; height:100%; background:rgba(0,0,0,0.6); }
  #historyContent { background:#fff; margin:6% auto; padding:16px; border-radius:12px; width:92%; max-width:720px; max-height:80vh; overflow:auto; }
`;
document.head.appendChild(style);

let map, userMarker, currentPoint;
function openMap(i){
  currentPoint = collectionPoints[i];
  document.getElementById("modalTitle").textContent = currentPoint.name;
  modal.style.display = "block";

  setTimeout(()=>{
    if(!map){
      map = L.map("map").setView([currentPoint.lat, currentPoint.lng], 15);
      L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
        attribution: '&copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a>'
      }).addTo(map);
    }
    map.setView([currentPoint.lat, currentPoint.lng], 15);

    // remove marcadores anteriores
    map.eachLayer(layer => { if(layer instanceof L.Marker) map.removeLayer(layer); });

    L.marker([currentPoint.lat, currentPoint.lng]).addTo(map).bindPopup(currentPoint.name).openPopup();

    if(navigator.geolocation){
      navigator.geolocation.getCurrentPosition((pos)=>{
        const userLat = pos.coords.latitude, userLng = pos.coords.longitude;
        if(userMarker) map.removeLayer(userMarker);
        userMarker = L.marker([userLat, userLng], {
          icon: L.icon({ iconUrl: "https://cdn-icons-png.flaticon.com/512/64/64113.png", iconSize: [28,28] })
        }).addTo(map).bindPopup("Voc√™ est√° aqui").openPopup();

        const distance = map.distance([userLat,userLng],[currentPoint.lat,currentPoint.lng]);
        const km = (distance/1000).toFixed(2);
        document.getElementById("distanceInfo").innerText = `Dist√¢ncia aproximada at√© este ponto: ${km} km`;
      }, ()=>{
        document.getElementById("distanceInfo").innerText = "N√£o foi poss√≠vel obter sua localiza√ß√£o.";
      });
    } else {
      document.getElementById("distanceInfo").innerText = "Seu navegador n√£o suporta geolocaliza√ß√£o.";
    }
  }, 100);
}

document.getElementById("closeModal").onclick = ()=> modal.style.display = "none";
window.onclick = (e)=> { if(e.target == modal) modal.style.display = "none"; };
document.getElementById("routeBtn").onclick = ()=> {
  if(currentPoint){
    const url = `https://www.google.com/maps/dir/?api=1&destination=${currentPoint.lat},${currentPoint.lng}`;
    window.open(url, "_blank");
  }
};

/* ========== QUIZ, HIST√ìRICO E CHART ========== */
const quizData = [
  { q: "Qual material a garrafa PET pertence?", a: ["Vidro","Pl√°stico","Metal"], correct: 1 },
  { q: "Devo lavar restos de comida antes de reciclar?", a: ["Sim, quando poss√≠vel","Nunca","S√≥ para vidro"], correct: 0 },
  { q: "Pilhas e baterias v√£o no lixo comum?", a: ["N√£o ‚Äî devem ser encaminhadas a pontos espec√≠ficos","Sim","S√≥ se estiverem quebradas"], correct: 0 },
];

let correctCount = 0;
let chart = null;

function getHistory(){
  try {
    return JSON.parse(localStorage.getItem("quizHistory") || "[]");
  } catch(e){
    return [];
  }
}
function setHistory(arr){
  localStorage.setItem("quizHistory", JSON.stringify(arr));
}

function renderQuiz(){
  correctCount = 0;
  const container = document.getElementById("quiz");
  container.innerHTML = "";
  quizData.forEach((item,i)=>{
    const qdiv = document.createElement("div"); qdiv.className = "question";
    qdiv.innerHTML = `<strong>Q${i+1}.</strong> ${item.q}`;
    const opts = document.createElement("div"); opts.className = "options";
    item.a.forEach((opt,j)=>{
      const btn = document.createElement("button"); btn.type="button"; btn.innerText = opt;
      btn.onclick = ()=> handleAnswer(i,j,btn);
      opts.appendChild(btn);
    });
    qdiv.appendChild(opts); container.appendChild(qdiv);
  });
  document.getElementById("quizResult").innerHTML = "";
}

function handleAnswer(qIndex, chosenIdx, btn){
  const correct = quizData[qIndex].correct;
  if(chosenIdx === correct){
    btn.style.borderColor = "green"; btn.style.background = "#ecfdf5"; btn.innerText += " ‚úì correto";
    correctCount++;
  } else {
    btn.style.borderColor = "crimson"; btn.style.background = "#fff1f2"; btn.innerText += " ‚úï";
  }
  const q = document.querySelectorAll(".question")[qIndex];
  q.querySelectorAll("button").forEach(b=> b.disabled = true);
  updateScore();
}

// conta quantas perguntas foram respondidas (uma por pergunta)
function countAnsweredQuestions(){
  const questions = Array.from(document.querySelectorAll(".question"));
  return questions.filter(q => Array.from(q.querySelectorAll("button")).some(b => b.disabled)).length;
}

function updateScore(){
  const total = quizData.length;
  const answered = countAnsweredQuestions();
  if(answered === total){
    const res = document.getElementById("quizResult");
    // cria bot√µes: refazer e ver hist√≥rico
    res.innerHTML = `
      <strong>Resultado:</strong> ${correctCount} de ${total} acertos.<br>
      <div style="margin-top:8px">
        <button class="btn" id="refazerBtn">Refazer Quiz</button>
        <button class="btn" id="verHistBtn" style="background:#374151; margin-left:8px">Ver hist√≥rico completo</button>
      </div>
      <div style="margin-top:12px"><canvas id="resultChart" style="height:180px"></canvas></div>
    `;

    document.getElementById("refazerBtn").onclick = ()=> resetQuiz();
    document.getElementById("verHistBtn").onclick = ()=> openHistoryModal();

    saveHistory(correctCount);
    drawChart();
  }
}

function resetQuiz(){
  renderQuiz();
}

/* SALVA lendo/escrevendo localStorage (garante persist√™ncia) */
function saveHistory(score){
  const total = quizData.length;
  const history = getHistory();
  history.push({ date: new Date().toLocaleString("pt-BR"), score, total });
  // mant√©m √∫ltimos 50 registros
  while(history.length > 50) history.shift();
  setHistory(history);
}

/* Desenha/atualiza Chart.js usando dados do localStorage */
function drawChart(){
  const history = getHistory();
  // garante que exista canvas
  const canvas = document.getElementById("resultChart");
  if(!canvas) return;
  const labels = history.map(h => h.date);
  const data = history.map(h => h.score);
  if(chart) chart.destroy();
  chart = new Chart(canvas.getContext("2d"), {
    type: "bar",
    data: {
      labels,
      datasets: [{
        label: "Acertos",
        data,
        backgroundColor: "#2a9d8f88",
        borderColor: "#2a9d8f",
        borderWidth: 1
      }]
    },
    options: {
      responsive: true,
      scales: { y: { beginAtZero: true, suggestedMax: quizData.length } }
    }
  });
}

/* ========== MODAL HIST√ìRICO COMPLETO ========== */
const historyModal = document.createElement("div");
historyModal.id = "historyModal";
historyModal.innerHTML = `
  <div id="historyContent">
    <div style="display:flex;justify-content:space-between;align-items:center">
      <h3>Hist√≥rico do Quiz</h3>
      <button id="closeHistory" class="btn" style="background:#ef4444">Fechar</button>
    </div>
    <div id="historyList" style="margin-top:12px"></div>
  </div>
`;
document.body.appendChild(historyModal);
document.getElementById("closeHistory").onclick = ()=> historyModal.style.display = "none";

function openHistoryModal(){
  const history = getHistory();
  const container = document.getElementById("historyList");
  if(history.length === 0){
    container.innerHTML = "<p style='color:var(--muted)'>Nenhuma tentativa registrada ainda.</p>";
  } else {
    // monta tabela simples
    let html = `<table style="width:100%; border-collapse:collapse;">
      <thead><tr style="text-align:left"><th>Data</th><th>Acertos</th><th>%</th></tr></thead><tbody>`;
    history.slice().reverse().forEach(h=>{
      const pct = Math.round((h.score / h.total) * 100);
      html += `<tr><td style="padding:8px;border-top:1px solid #eee">${h.date}</td><td style="padding:8px;border-top:1px solid #eee">${h.score}/${h.total}</td><td style="padding:8px;border-top:1px solid #eee">${pct}%</td></tr>`;
    });
    html += `</tbody></table>`;
    container.innerHTML = html;
  }
  historyModal.style.display = "block";
}

/* ========== RENDER INICIAL & FORM ========== */
renderQuiz();
if(getHistory().length > 0) {
  // cria um canvas tempor√°rio para desenhar o gr√°fico no carregamento inicial
  const resultHolder = document.createElement("div");
  resultHolder.style.display = "none"; // n√£o mostrar at√© o usu√°rio completar o quiz
  resultHolder.innerHTML = `<canvas id="resultChart"></canvas>`;
  document.body.appendChild(resultHolder);
  drawChart();
}

document.getElementById("contactForm").addEventListener("submit", (e)=>{
  e.preventDefault();
  const f = new FormData(e.target);
  const name = f.get("name") || "An√¥nimo";
  const msg = f.get("message") || "";
  const total = quizData.length;
  const resultMsg = `‚úÖ Obrigado, ${name}!\nVoc√™ finalizou o quiz com ${correctCount} de ${total} acertos.\nüì® Sua mensagem: "${msg}"`;
  document.getElementById("contactFlash").innerText = resultMsg;
  e.target.reset();
});
</script>


<script>
/* ====== CONFIGURA√á√ÉO B√ÅSICA DOS CANVAS ====== */
const canvases = [
  { el: document.getElementById('headerCanvas'), ctx: null },
  { el: document.getElementById('bodyCanvas'), ctx: null }
];

canvases.forEach(c => {
  c.ctx = c.el.getContext('2d');
  resizeCanvas(c);
  window.addEventListener('resize', () => resizeCanvas(c));
});

function resizeCanvas(c){
  c.el.width = c.el.offsetWidth;
  c.el.height = c.el.offsetHeight;
}

/* ====== MOUSE TRACKING ====== */
let mouse = { x: 0, y: 0 };
document.addEventListener('mousemove', e => { mouse.x = e.clientX; mouse.y = e.clientY; });

/* ====== VENTO ====== */
let wind = 0;
setInterval(() => {
  wind = Math.sin(Date.now() * 0.001) * 0.3; // varia√ß√£o suave do vento
}, 50);

/* ====== FOLHAS ====== */
class Leaf {
  constructor(canvas){
    this.canvas = canvas;
    this.ctx = canvas.ctx;
    this.reset();
  }
  reset(){
    this.x = Math.random() * this.canvas.el.width;
    this.y = Math.random() * this.canvas.el.height;
    this.size = Math.random() * 6 + 4;
    this.speedX = Math.random() * 0.5 - 0.25;
    this.speedY = Math.random() * 0.3 + 0.1;
    this.angle = Math.random() * 2 * Math.PI;
    this.color = `rgba(34,139,34,${Math.random()*0.6 + 0.3})`;
  }
  update(){
    this.x += this.speedX + wind;
    this.y += this.speedY;
    this.angle += 0.01;
    if(this.y > this.canvas.el.height || this.x < -20 || this.x > this.canvas.el.width+20) this.reset();
  }
  draw(){
    this.ctx.save();
    this.ctx.translate(this.x, this.y);
    this.ctx.rotate(Math.sin(this.angle));
    this.ctx.fillStyle = this.color;
    this.ctx.beginPath();
    this.ctx.ellipse(0, 0, this.size, this.size/2, 0, 0, Math.PI*2);
    this.ctx.fill();
    this.ctx.restore();
  }
}

/* ====== PARTICULAS BRILHO ====== */
class Particle {
  constructor(canvas){
    this.canvas = canvas;
    this.ctx = canvas.ctx;
    this.reset();
  }
  reset(){
    this.x = Math.random() * this.canvas.el.width;
    this.y = Math.random() * this.canvas.el.height;
    this.radius = Math.random() * 2 + 1;
    this.speedX = Math.random() * 0.3 - 0.15 + wind;
    this.speedY = Math.random() * 0.3 - 0.15;
    this.alpha = Math.random();
    this.alphaSpeed = Math.random() * 0.02 + 0.005;
  }
  update(){
    this.x += this.speedX + wind;
    this.y += this.speedY;
    this.alpha += this.alphaSpeed;
    if(this.alpha > 1 || this.alpha < 0) this.alphaSpeed *= -1;
    if(this.x < 0 || this.x > this.canvas.el.width || this.y < 0 || this.y > this.canvas.el.height) this.reset();
  }
  draw(){
    const gradient = this.ctx.createRadialGradient(this.x, this.y, 0, this.x, this.y, this.radius*2);
    gradient.addColorStop(0, `rgba(255,255,255,${this.alpha})`);
    gradient.addColorStop(1, `rgba(255,255,255,0)`);
    this.ctx.fillStyle = gradient;
    this.ctx.beginPath();
    this.ctx.arc(this.x, this.y, this.radius*2, 0, 2*Math.PI);
    this.ctx.fill();
  }
}

/* ====== TRAIL DE FOLHAS COM BRILHO ====== */
class TrailLeaf {
  constructor(){
    this.x = mouse.x;
    this.y = mouse.y;
    this.size = Math.random() * 8 + 4;
    this.speedX = Math.random() * 0.4 - 0.2 + wind;
    this.speedY = Math.random() * 0.4 - 0.2;
    this.angle = Math.random() * 2*Math.PI;
    this.rotationSpeed = Math.random()*0.05 - 0.025;
    this.alpha = 1;
    this.particles = [];
  }
  update(){
    this.x += this.speedX;
    this.y += this.speedY;
    this.angle += this.rotationSpeed;
    this.alpha -= 0.02;
    
    // part√≠culas pulsantes saindo da folha
    if(Math.random() < 0.5){
      this.particles.push({ 
        x: this.x, 
        y: this.y, 
        radius: Math.random()*2+1, 
        alpha:1, 
        speedX:(Math.random()-0.5)*0.5 + wind, 
        speedY:(Math.random()-0.5)*0.5 
      });
    }
    this.particles.forEach((p,i)=>{
      p.x += p.speedX;
      p.y += p.speedY;
      p.alpha -= 0.03;
      if(p.alpha <= 0) this.particles.splice(i,1);
    });
  }
  draw(ctx){
    ctx.save();
    ctx.translate(this.x, this.y);
    ctx.rotate(this.angle);
    ctx.fillStyle = `rgba(34,139,34,${this.alpha})`;
    ctx.beginPath();
    ctx.ellipse(0,0,this.size,this.size/2,0,0,Math.PI*2);
    ctx.fill();
    ctx.restore();

    // part√≠culas com gradiente pulsante
    this.particles.forEach(p=>{
      const gradient = ctx.createRadialGradient(p.x,p.y,0,p.x,p.y,p.radius*2);
      gradient.addColorStop(0, `rgba(255,255,255,${p.alpha})`);
      gradient.addColorStop(1, `rgba(255,255,255,0)`);
      ctx.fillStyle = gradient;
      ctx.beginPath();
      ctx.arc(p.x,p.y,p.radius*2,0,2*Math.PI);
      ctx.fill();
    });
  }
}

/* ====== OBJETOS ====== */
let leaves = [], particles = [], trailLeaves = [];

canvases.forEach(c => {
  for(let i=0;i<50;i++) leaves.push(new Leaf(c));
  for(let i=0;i<60;i++) particles.push(new Particle(c));
});

/* ====== ANIMA√á√ÉO ====== */
function animate(){
  canvases.forEach(c => {
    c.ctx.clearRect(0,0,c.el.width,c.el.height);
  });
  
  // part√≠culas e folhas
  particles.forEach(p => { p.update(); p.draw(); });
  leaves.forEach(l => { l.update(); l.draw(); });

  // trail
  const headerCtx = canvases[0].ctx;
  trailLeaves.push(new TrailLeaf());
  trailLeaves.forEach((t,i)=>{
    t.update();
    t.draw(headerCtx);
    if(t.alpha <= 0) trailLeaves.splice(i,1);
  });

  requestAnimationFrame(animate);
}

animate();
</script>





</body>
</html>
